
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
</head>
<body>
  <script src="https://prakt.chemie.unibas.ch/~devereux/ngl-master/dist/ngl.js"></script>
<!--  <script src="https://unpkg.com/ngl"></script>-->
  <script>
    var xyzFile = 'http://localhost:8000/5-refine/18-charges/18-charges.pdb' 
    var pdbFile = 'http://localhost:8000/ref/mol.pdb'
  </script>
  <h3>NGL Visualization of Molecular Models Constructed from Fragments</h3>
  
  <table><tr><td>No. of charges</td><td>
  <input type="number" id="nChg" min="18" max="54" step="1" value="18" onkeydown="return false" 
  onmouseup="loadXYZ()"></td></tr>
  </table>
  <br>

  <table><tr><td>
  <p><div id="viewer"></div></p>
  </td></tr><tr><td>
  <div id="viewport" style="width:800px; height:800px;"></div>
  </td></tr></table>
  <script>
      var minChgs=18;
      var rmse=[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.6938471917,0.6713365142,0.6628976981,0.6102332452,0.6045533599,0.5902974197,0.5792981058,0.5812717144,0.5688721648,0.5562012943,0.5505071537,0.5480969299,0.5417486943,0.5367713626,0.535991703,0.5303124819,0.5298790481,0.5250048969,0.5235558153,0.5207990961,0.5186505952,0.5176672943,0.5176111357,0.5177609325,0.5180086372,0.515453988,0.5145482638];

    document.addEventListener("DOMContentLoaded", function () {
        loadXYZ();
    } );

    function loadXYZ() {
      var nChg = document.getElementById("nChg").value;
      var file = '5-refine/'+nChg+'-charges/'+nChg+'-charges.pdb';
      document.getElementById("viewer").innerHTML = file +'<br>RMSE: '+rmse[nChg-minChgs].toFixed(3)+' kcal/mol';
      document.getElementById("viewport").innerHTML = "";
      xyzFile = 'http://localhost:8000/'+file

      var stage = new NGL.Stage("viewport");

      Promise.all([
        stage.loadFile(pdbFile),
        stage.loadFile(xyzFile)
      ]).then(function(comp) {
        var pdbComp = comp[0]
        var xyzComp = comp[1]

        pdbComp.addRepresentation("line");
        pdbComp.addRepresentation("label",{labelType: "atomname",
                                        radius: "0.7",
                                           color: "cyan"});
        xyzComp.addRepresentation("spacefill",{radius: "0.1"});
        stage.autoView();
        } );
        
    }
  </script>
</body>
</html>
